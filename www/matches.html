<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Today's Matches</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;
            background-color: #121212;
            color: #e0e0e0;
            margin: 0;
            padding: 16px;
        }
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 16px;
            border-bottom: 1px solid #333;
        }
        header h1 {
            font-size: 24px;
            margin: 0;
        }
        .back-button {
            color: #e0e0e0;
            text-decoration: none;
            font-size: 16px;
            padding: 8px 12px;
            background-color: #333;
            border-radius: 8px;
        }
        .competition-group {
            margin-top: 24px;
        }
        .competition-title {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 2px solid #4a90e2;
        }
        .match-card {
            background-color: #1e1e1e;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
            display: flex;
            flex-direction: column;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .match-teams {
            display: flex;
            justify-content: space-around;
            align-items: center;
            margin-bottom: 16px;
        }
        .team {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100px;
        }
        .team img {
            width: 50px;
            height: 50px;
            margin-bottom: 8px;
        }
        .team-name {
            font-size: 14px;
            text-align: center;
        }
        .match-center {
            text-align: center;
        }
        .match-time, .match-result {
            font-size: 20px;
            font-weight: bold;
        }
        .match-status {
            font-size: 12px;
            color: #aaa;
            background-color: #333;
            padding: 2px 6px;
            border-radius: 4px;
        }
        .match-details {
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 14px;
            color: #bbb;
            border-top: 1px solid #333;
            padding-top: 12px;
            margin-top: 12px;
        }
        .match-channel {
            margin: 0 10px;
        }
        .loading, .error {
            text-align: center;
            margin-top: 50px;
            font-size: 18px;
        }
    </style>
</head>
<body>

    <header>
        <h1>Today's Matches</h1>
        <a href="index.html" class="back-button">Back to Channels</a>
    </header>

    <main id="matches-container">
        <div class="loading">Loading matches...</div>
    </main>

    <script>
        // Function to transliterate Arabic/French names to correct English equivalents
        function transliterateToEnglish(text) {
            // Mapping for specific Arabic team names to their correct English equivalents
            const nameMapping = {
                // Common Arabic team names with their English equivalents
                "Ø§Ù„Ø¬ÙŠØ´ Ø§Ù„Ø±ÙˆØ§Ù†Ø¯ÙŠ": "Army Rwanda",
                "Ø¨ÙŠØ±Ø§Ù…ÙŠØ¯Ø²": "Pyramids",
                "Ø£ÙˆÙ„Ù…Ø¨ÙŠÙƒ Ø¢Ø³ÙÙŠ": "Olympic Safi",
                "Ø­Ø³Ù†ÙŠØ© Ø£ÙƒØ§Ø¯ÙŠØ±": "Hassania Agadir",
                "ÙƒØ±Ø¨Øº AÄŸdam": "Qarabag Agdam",  // This is closer to the actual spelling
                "ÙƒÙˆØ¨Ù†Ù‡Ø§Ø¬Ù†": "Copenhagen",
                "ÙŠÙˆÙ†ÙŠÙˆÙ† Ø³Ø§Ù†Øª Ø¬ÙŠÙ„ÙˆØ§Ø²": "Union Saint-Gilloise",
                "Ù†ÙŠÙˆÙƒØ§Ø³Ù„ ÙŠÙˆÙ†Ø§ÙŠØªØ¯": "Newcastle United",
                "Ø§Ù„Ø¬ÙŠØ´ Ø§Ù„Ù…Ù„ÙƒÙŠ": "Royal Army",
                "Ø§ØªØ­Ø§Ø¯ Ø·Ù†Ø¬Ø©": "Tangier Union",
                "Ø¨ÙˆØ±ÙˆØ³ÙŠØ§ Ø¯ÙˆØ±ØªÙ…ÙˆÙ†Ø¯": "Borussia Dortmund",
                "Ø£ØªÙ„ØªÙŠÙƒ Ø¨Ù„Ø¨Ø§Ùˆ": "Athletic Bilbao",
                "ÙÙŠØ§Ø±ÙŠØ§Ù„": "Villarreal",
                "ÙŠÙˆÙÙ†ØªÙˆØ³": "Juventus",
                "Ø¨Ø±Ø´Ù„ÙˆÙ†Ø©": "Barcelona",
                "Ø¨Ø§Ø±ÙŠØ³ Ø³Ø§Ù† Ø¬ÙŠØ±Ù…Ø§Ù†": "Paris Saint-Germain",
                "Ù†Ø§Ø¨ÙˆÙ„ÙŠ": "Napoli",
                "Ø³Ø¨ÙˆØ±ØªÙ†Ø¬ Ù„Ø´Ø¨ÙˆÙ†Ø©": "Sporting Lisbon",
                "Ù†Ù‡Ø¶Ø© Ø¨Ø±ÙƒØ§Ù†": "NA Hussein Dey", // This might be NA Hussein Dey, but if it refers to Raja Beni Mellal, it might be Raja Casablanca
                "Ø§ØªØ­Ø§Ø¯ ÙŠØ¹Ù‚ÙˆØ¨ Ø§Ù„Ù…Ù†ØµÙˆØ±": "Union Yaakoub El Mansour",
                "Ø¨Ø§ÙŠØ± Ù„ÙŠÙØ±ÙƒÙˆØ²Ù†": "Bayer Leverkusen",
                "Ø¢ÙŠÙ†Ø¯Ù‡ÙˆÙÙ†": "PSV Eindhoven",
                "Ù…ÙˆÙ†Ø§ÙƒÙˆ": "Monaco",
                "Ù…Ø§Ù†Ø´Ø³ØªØ± Ø³ÙŠØªÙŠ": "Manchester City",
                "Ø£Ø±Ø³Ù†Ø§Ù„": "Arsenal",
                "Ø£ÙˆÙ„Ù…Ø¨ÙŠØ§ÙƒÙˆØ³": "Olympiacos",
                "Ø¥Ø³Ø¨Ø§Ù†ÙŠØ§ ØªØ­Øª 20": "Spain U20",
                "Ø§Ù„Ù…ÙƒØ³ÙŠÙƒ ØªØ­Øª 20": "Mexico U20",
                "Ø¥ÙŠØ·Ø§Ù„ÙŠØ§ ØªØ­Øª 20": "Italy U20",
                "ÙƒÙˆØ¨Ø§ ØªØ­Øª 20": "Cuba U20",
                "ØªØ´ÙŠÙ„ÙŠ ØªØ­Øª 20": "Chile U20",
                "Ø§Ù„ÙŠØ§Ø¨Ø§Ù† ØªØ­Øª 20": "Japan U20",
                "ÙƒÙˆØ±ÙŠØ§ Ø§Ù„Ø¬Ù†ÙˆØ¨ÙŠØ© ØªØ­Øª 20": "South Korea U20",
                "Ø¨Ø§Ø±Ø§ØºÙˆØ§ÙŠ ØªØ­Øª 20": "Paraguay U20",
                "Ø§Ù†ØªØ± Ù…ÙŠØ§Ù…ÙŠ": "Inter Miami",
                "Ø´ÙŠÙƒØ§ØºÙˆ ÙØ§ÙŠØ±": "Chicago Fire",
                
                // Specific teams with proper English names
                "Ø±ÙŠØ§Ù„ Ø¨ÙŠØªÙŠØ³": "Real Betis",
                "Ø¯ÙŠØ§ÙˆÙ…Ùˆ ÙƒÙŠÙŠÙ": "Dynamo Kiev",
                "ÙƒØ±ÙŠØ³ØªØ§Ù„ Ø¨Ø§Ù„Ø§Ø³": "Crystal Palace",
                "FcnrbØ®Ø´Ø©": "Fenerbahce", // Fenerbahce in Arabic script
                "Ø±ÙŠÙ†Ø¬Ø±Ø²": "Rangers",
                "Ø£ÙˆÙ„Ù…Ø¨ÙŠÙƒ Ù„ÙŠÙˆÙ†": "Olympique Lyon",
                "Ø´ØªÙˆØªØ¬Ø§Ø±Øª": "Stuttgart",
                
                // Arabic competition names
                "Ø£ÙØ±ÙŠÙ‚ÙŠØ§, Ø¯ÙˆØ±ÙŠ Ø£Ø¨Ø·Ø§Ù„ Ø£ÙØ±ÙŠÙ‚ÙŠØ§ - ØªØµÙÙŠØ§Øª": "Africa, CAF Champions League - Qualifiers",
                "Ø§Ù„Ù…ØºØ±Ø¨, Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„Ù…ØºØ±Ø¨ÙŠ": "Morocco, Moroccan League",
                "Ø£ÙˆØ±ÙˆØ¨Ø§, Ø¯ÙˆØ±ÙŠ Ø£Ø¨Ø·Ø§Ù„ Ø§ÙˆØ±ÙˆØ¨Ø§": "Europe, UEFA Champions League",
                "Ø¯ÙˆÙ„ÙŠ, ÙƒØ£Ø³ Ø§Ù„Ø¹Ø§Ù„Ù… ØªØ­Øª 20 - Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª": "International, World Cup U20 - Groups",
                
                // Arabic status text
                "Ù„Ù… ØªØ¨Ø¯Ø£ Ø¨Ø¹Ø¯": "Not started yet",
                "Ø§Ù†ØªÙ‡Øª": "Finished",
                "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ": "Unknown",
                
                // Add more mappings as needed
            };
            
            // Check if we have a direct mapping for this text
            if (nameMapping[text]) {
                return nameMapping[text];
            }
            
            // Some names might be partially in Arabic and need special handling
            // Check if it contains Arabic script but isn't in our mapping
            if (/[\u0600-\u06FF]/.test(text)) {
                // For names that are transliterated Arabic, we'll keep the existing name as is
                // But first try to find if the Arabic text is similar to any known names
                // by checking for common Arabic-to-English equivalents
                let processedText = text;
                
                // Common Arabic words in team names
                processedText = processedText
                    .replace(/Ø§Ù„(.+?)\s+/g, '$1 ') // Remove "Ø§Ù„" prefix
                    .replace(/\s+Ø§Ù„(.+?)$/g, ' $1') // Remove "Ø§Ù„" prefix in final position
                    .replace(/(.+?)\s+Ø§Ù„(.+?)$/g, '$1 $2'); // Remove "Ø§Ù„" from middle of name
                
                // Return the original text if no mapping is found, to be translated by a service
                return text;
            }
            
            // For names that are already in Latin script, return them as is
            if (/^[A-Za-z\s\-\'\.\&\d]+$/.test(text)) {
                return text;
            }
            
            // If no mapping exists, return the original text
            return text;
        }

        document.addEventListener('DOMContentLoaded', () => {
            const container = document.getElementById('matches-container');
            
            // Get today's date in YYYY-MM-DD format
            const today = new Date();
            const todayString = today.toISOString().split('T')[0];
            
            // First, try to fetch matches from the GitHub source
            fetch('https://amouradore.github.io/chaine-en-live/today.json')
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(githubData => {
                    container.innerHTML = ''; // Clear loading message

                    // Check if GitHub source has matches for today
                    const githubMatches = githubData.matches;

                    if (githubMatches && githubMatches.length > 0) {
                        // Group matches by competition
                        const competitions = githubMatches.reduce((acc, match) => {
                            // Transliterate the competition name
                            const comp = transliterateToEnglish(match.competition) || 'Other Competitions';
                            if (!acc[comp]) {
                                acc[comp] = [];
                            }
                            acc[comp].push(match);
                            return acc;
                        }, {});

                        // Render matches for each competition
                        for (const competitionName in competitions) {
                            const competitionGroup = document.createElement('div');
                            competitionGroup.className = 'competition-group';

                            const competitionTitle = document.createElement('div');
                            competitionTitle.className = 'competition-title';
                            competitionTitle.textContent = competitionName;
                            competitionGroup.appendChild(competitionTitle);

                            competitions[competitionName].forEach(match => {
                                const card = document.createElement('div');
                                card.className = 'match-card';

                                // Transliterate status text
                                let statusText = transliterateToEnglish(match.status_text);
                                let resultOrTime;

                                if (match.status !== 'NS') { // Not Started
                                    resultOrTime = `<div class="match-result">${match.result_text}</div>`;
                                } else {
                                    // Timezone conversion logic
                                    const matchDate = githubData.date; // e.g., "2025-10-02"
                                    const baghdadTime = match.time_baghdad; // e.g., "15:00"
                                    
                                    if (matchDate && baghdadTime) {
                                        // Create an ISO string assuming Baghdad is UTC+3
                                        const isoString = `${matchDate}T${baghdadTime}:00+03:00`;
                                        const dateObj = new Date(isoString);

                                        // Check if the date is valid
                                        if (!isNaN(dateObj)) {
                                            // Format to user's local time
                                            const localTime = dateObj.toLocaleTimeString(navigator.language || 'en-US', { hour: '2-digit', minute: '2-digit' });
                                            resultOrTime = `<div class="match-time">${localTime}</div>`;
                                        } else {
                                            // Fallback to original time if conversion fails
                                            resultOrTime = `<div class="match-time">${match.time_baghdad}</div>`;
                                        }
                                    } else {
                                        resultOrTime = `<div class="match-time">${match.time_baghdad}</div>`;
                                    }
                                }

                                // Transliterate team names and channel
                                const homeTeam = transliterateToEnglish(match.home);
                                const awayTeam = transliterateToEnglish(match.away);
                                const channelName = transliterateToEnglish(match.channel);

                                card.innerHTML = `
                                    <div class="match-teams">
                                        <div class="team">
                                            <img src="${match.home_logo}" alt="${homeTeam}" onerror="this.src='https://via.placeholder.com/60?text=N/A';">
                                            <div class="team-name">${homeTeam}</div>
                                        </div>
                                        <div class="match-center">
                                            ${resultOrTime}
                                            <div class="match-status">${statusText}</div>
                                        </div>
                                        <div class="team">
                                            <img src="${match.away_logo}" alt="${awayTeam}" onerror="this.src='https://via.placeholder.com/60?text=N/A';">
                                            <div class="team-name">${awayTeam}</div>
                                        </div>
                                    </div>
                                    <div class="match-details">
                                        <span class="match-channel">ðŸ“º ${channelName}</span>
                                    </div>
                                `;
                                competitionGroup.appendChild(card);
                            });
                            container.appendChild(competitionGroup);
                        }
                    } else {
                        // If no matches from GitHub, try the local file as fallback
                        return fetch('matches/today.json')
                            .then(response => {
                                if (!response.ok) {
                                    throw new Error(`HTTP error! status: ${response.status}`);
                                }
                                return response.json();
                            })
                            .then(localData => {
                                const localMatches = localData.matches;

                                if (!localMatches || localMatches.length === 0) {
                                    container.innerHTML = '<div class="error">No matches today.</div>';
                                    return;
                                }

                                // Group local matches by competition
                                const localCompetitions = localMatches.reduce((acc, match) => {
                                    // Transliterate the competition name
                                    const comp = transliterateToEnglish(match.competition) || 'Other Competitions';
                                    if (!acc[comp]) {
                                        acc[comp] = [];
                                    }
                                    acc[comp].push(match);
                                    return acc;
                                }, {});

                                // Render local matches for each competition
                                for (const competitionName in localCompetitions) {
                                    const competitionGroup = document.createElement('div');
                                    competitionGroup.className = 'competition-group';

                                    const competitionTitle = document.createElement('div');
                                    competitionTitle.className = 'competition-title';
                                    competitionTitle.textContent = competitionName;
                                    competitionGroup.appendChild(competitionTitle);

                                    localCompetitions[competitionName].forEach(match => {
                                        const card = document.createElement('div');
                                        card.className = 'match-card';

                                        // Transliterate status text
                                        let statusText = transliterateToEnglish(match.status_text);
                                        let resultOrTime;

                                        if (match.status !== 'NS') { // Not Started
                                            resultOrTime = `<div class="match-result">${match.result_text}</div>`;
                                        } else {
                                            // Timezone conversion logic using today's date
                                            const matchDate = todayString; // Use today's date
                                            const baghdadTime = match.time_baghdad; // e.g., "15:00"
                                            
                                            if (matchDate && baghdadTime) {
                                                // Create an ISO string assuming Baghdad is UTC+3
                                                const isoString = `${matchDate}T${baghdadTime}:00+03:00`;
                                                const dateObj = new Date(isoString);

                                                // Check if the date is valid
                                                if (!isNaN(dateObj)) {
                                                    // Format to user's local time
                                                    const localTime = dateObj.toLocaleTimeString(navigator.language || 'en-US', { hour: '2-digit', minute: '2-digit' });
                                                    resultOrTime = `<div class="match-time">${localTime}</div>`;
                                                } else {
                                                    // Fallback to original time if conversion fails
                                                    resultOrTime = `<div class="match-time">${match.time_baghdad}</div>`;
                                                }
                                            } else {
                                                resultOrTime = `<div class="match-time">${match.time_baghdad}</div>`;
                                            }
                                        }

                                        // Transliterate team names and channel
                                        const homeTeam = transliterateToEnglish(match.home);
                                        const awayTeam = transliterateToEnglish(match.away);
                                        const channelName = transliterateToEnglish(match.channel);

                                        card.innerHTML = `
                                            <div class="match-teams">
                                                <div class="team">
                                                    <img src="${match.home_logo}" alt="${homeTeam}" onerror="this.src='https://via.placeholder.com/60?text=N/A';">
                                                    <div class="team-name">${homeTeam}</div>
                                                </div>
                                                <div class="match-center">
                                                    ${resultOrTime}
                                                    <div class="match-status">${statusText}</div>
                                                </div>
                                                <div class="team">
                                                    <img src="${match.away_logo}" alt="${awayTeam}" onerror="this.src='https://via.placeholder.com/60?text=N/A';">
                                                    <div class="team-name">${awayTeam}</div>
                                                </div>
                                            </div>
                                            <div class="match-details">
                                                <span class="match-channel">ðŸ“º ${channelName}</span>
                                            </div>
                                        `;
                                        competitionGroup.appendChild(card);
                                    });
                                    container.appendChild(competitionGroup);
                                }
                            })
                            .catch(localError => {
                                console.error('Error fetching local matches:', localError);
                                container.innerHTML = '<div class="error">No matches today from both sources.</div>';
                            });
                    }
                })
                .catch(githubError => {
                    console.error('Error fetching GitHub matches:', githubError);
                    // If GitHub source fails, try the local file as fallback
                    fetch('matches/today.json')
                        .then(response => {
                            if (!response.ok) {
                                throw new Error(`HTTP error! status: ${response.status}`);
                            }
                            return response.json();
                        })
                        .then(localData => {
                            container.innerHTML = ''; // Clear error message

                            const localMatches = localData.matches;

                            if (!localMatches || localMatches.length === 0) {
                                container.innerHTML = '<div class="error">No matches today.</div>';
                                return;
                            }

                            // Group local matches by competition
                            const localCompetitions = localMatches.reduce((acc, match) => {
                                // Transliterate the competition name
                                const comp = transliterateToEnglish(match.competition) || 'Other Competitions';
                                if (!acc[comp]) {
                                    acc[comp] = [];
                                }
                                acc[comp].push(match);
                                return acc;
                            }, {});

                            // Render local matches for each competition
                            for (const competitionName in localCompetitions) {
                                const competitionGroup = document.createElement('div');
                                competitionGroup.className = 'competition-group';

                                const competitionTitle = document.createElement('div');
                                competitionTitle.className = 'competition-title';
                                competitionTitle.textContent = competitionName;
                                competitionGroup.appendChild(competitionTitle);

                                localCompetitions[competitionName].forEach(match => {
                                    const card = document.createElement('div');
                                    card.className = 'match-card';

                                    // Transliterate status text
                                    let statusText = transliterateToEnglish(match.status_text);
                                    let resultOrTime;

                                    if (match.status !== 'NS') { // Not Started
                                        resultOrTime = `<div class="match-result">${match.result_text}</div>`;
                                    } else {
                                        // Timezone conversion logic using today's date
                                        const matchDate = todayString; // Use today's date
                                        const baghdadTime = match.time_baghdad; // e.g., "15:00"
                                        
                                        if (matchDate && baghdadTime) {
                                            // Create an ISO string assuming Baghdad is UTC+3
                                            const isoString = `${matchDate}T${baghdadTime}:00+03:00`;
                                            const dateObj = new Date(isoString);

                                            // Check if the date is valid
                                            if (!isNaN(dateObj)) {
                                                // Format to user's local time
                                                const localTime = dateObj.toLocaleTimeString(navigator.language || 'en-US', { hour: '2-digit', minute: '2-digit' });
                                                resultOrTime = `<div class="match-time">${localTime}</div>`;
                                            } else {
                                                // Fallback to original time if conversion fails
                                                resultOrTime = `<div class="match-time">${match.time_baghdad}</div>`;
                                            }
                                        } else {
                                            resultOrTime = `<div class="match-time">${match.time_baghdad}</div>`;
                                        }
                                    }

                                    // Transliterate team names and channel
                                    const homeTeam = transliterateToEnglish(match.home);
                                    const awayTeam = transliterateToEnglish(match.away);
                                    const channelName = transliterateToEnglish(match.channel);

                                    card.innerHTML = `
                                        <div class="match-teams">
                                            <div class="team">
                                                <img src="${match.home_logo}" alt="${homeTeam}" onerror="this.src='https://via.placeholder.com/60?text=N/A';">
                                                <div class="team-name">${homeTeam}</div>
                                            </div>
                                            <div class="match-center">
                                                ${resultOrTime}
                                                <div class="match-status">${statusText}</div>
                                            </div>
                                            <div class="team">
                                                <img src="${match.away_logo}" alt="${awayTeam}" onerror="this.src='https://via.placeholder.com/60?text=N/A';">
                                                <div class="team-name">${awayTeam}</div>
                                            </div>
                                        </div>
                                        <div class="match-details">
                                            <span class="match-channel">ðŸ“º ${channelName}</span>
                                        </div>
                                    `;
                                    competitionGroup.appendChild(card);
                                });
                                container.appendChild(competitionGroup);
                            }
                        })
                        .catch(localError => {
                            console.error('Error fetching local matches:', localError);
                            container.innerHTML = '<div class="error">An error occurred while loading matches from both sources.</div>';
                        });
                });
        });
    </script>

</body>
</html>